{
	"info": {
		"_postman_id": "56bfa3bd-23ba-4699-bc7c-36c27e156cb6",
		"name": "Webhooks",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Get Access Token",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.environment.set(\"access_token\", pm.response.json().access_token);"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "client_id",
						"value": "{{client_id}}"
					},
					{
						"key": "client_secret",
						"value": "{{client_secret}}"
					},
					{
						"key": "Ocp-Apim-Subscription-Key",
						"value": "{{Ocp-Apim-Subscription-Key}}",
						"type": "default"
					},
					{
						"key": "Merchant-Serial-Number",
						"value": "{{merchantSerialNumber}}",
						"type": "default"
					},
					{
						"key": "Vipps-System-Name",
						"value": "{{vipps_system_name}}",
						"type": "default"
					},
					{
						"key": "Vipps-System-Version",
						"value": "{{vipps_system_version}}",
						"type": "default"
					},
					{
						"key": "Vipps-System-Plugin-Name",
						"value": "{{vipps_system_plugin_name}}",
						"type": "default"
					},
					{
						"key": "Vipps-System-Plugin-Version",
						"value": "{{vipps_system_plugin_version}}",
						"type": "default"
					}
				],
				"body": {
					"mode": "raw",
					"raw": ""
				},
				"url": {
					"raw": "https://apitest.vipps.no/accessToken/get",
					"protocol": "https",
					"host": [
						"apitest",
						"vipps",
						"no"
					],
					"path": [
						"accessToken",
						"get"
					]
				}
			},
			"response": []
		},
		{
			"name": "Register",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Should pass\", () => {\r",
							"    pm.response.to.have.status(201)\r",
							"\r",
							"    const responseBody = pm.response.json()\r",
							"    pm.environment.set(\"webhook_id\", responseBody.id)\r",
							"})"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"protocolProfileBehavior": {
				"tlsDisabledProtocols": []
			},
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{access_token}}",
							"type": "string"
						}
					]
				},
				"method": "POST",
				"header": [
					{
						"key": "Ocp-Apim-Subscription-Key",
						"value": "{{Ocp-Apim-Subscription-Key}}",
						"type": "default"
					},
					{
						"key": "Merchant-Serial-Number",
						"value": "{{merchantSerialNumber}}",
						"type": "default"
					},
					{
						"key": "Vipps-System-Name",
						"value": "{{vipps_system_name}}",
						"type": "default"
					},
					{
						"key": "Vipps-System-Version",
						"value": "{{vipps_system_version}}",
						"type": "default"
					},
					{
						"key": "Vipps-System-Plugin-Name",
						"value": "{{vipps_system_plugin_name}}",
						"type": "default"
					},
					{
						"key": "Vipps-System-Plugin-Version",
						"value": "{{vipps_system_plugin_version}}",
						"type": "default"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\r\n    \"url\": \"{{callbackUrl}}\",\r\n    \"events\": [\"epayments.payment.captured.v1\"]\r\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{base_url}}/webhooks/v1/webhooks",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"webhooks",
						"v1",
						"webhooks"
					]
				}
			},
			"response": []
		},
		{
			"name": "Get All",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Should pass\", () => {\r",
							"    pm.response.to.have.status(200)\r",
							"})"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{access_token}}",
							"type": "string"
						}
					]
				},
				"method": "GET",
				"header": [
					{
						"key": "Ocp-Apim-Subscription-Key",
						"value": "{{Ocp-Apim-Subscription-Key}}",
						"type": "default"
					},
					{
						"key": "Merchant-Serial-Number",
						"value": "{{merchantSerialNumber}}",
						"type": "default"
					},
					{
						"key": "Vipps-System-Name",
						"value": "{{vipps_system_name}}",
						"type": "default"
					},
					{
						"key": "Vipps-System-Version",
						"value": "{{vipps_system_version}}",
						"type": "default"
					},
					{
						"key": "Vipps-System-Plugin-Name",
						"value": "{{vipps_system_plugin_name}}",
						"type": "default"
					},
					{
						"key": "Vipps-System-Plugin-Version",
						"value": "{{vipps_system_plugin_version}}",
						"type": "default"
					}
				],
				"url": {
					"raw": "{{base_url}}/webhooks/v1/webhooks",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"webhooks",
						"v1",
						"webhooks"
					]
				}
			},
			"response": []
		},
		{
			"name": "Delete Last",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Should pass\", () => {\r",
							"    pm.response.to.have.status(204)\r",
							"})"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{access_token}}",
							"type": "string"
						}
					]
				},
				"method": "DELETE",
				"header": [
					{
						"key": "Ocp-Apim-Subscription-Key",
						"value": "{{Ocp-Apim-Subscription-Key}}",
						"type": "default"
					},
					{
						"key": "Merchant-Serial-Number",
						"value": "{{merchantSerialNumber}}",
						"type": "default"
					},
					{
						"key": "Vipps-System-Name",
						"value": "{{vipps_system_name}}",
						"type": "default"
					},
					{
						"key": "Vipps-System-Version",
						"value": "{{vipps_system_version}}",
						"type": "default"
					},
					{
						"key": "Vipps-System-Plugin-Name",
						"value": "{{vipps_system_plugin_name}}",
						"type": "default"
					},
					{
						"key": "Vipps-System-Plugin-Version",
						"value": "{{vipps_system_plugin_version}}",
						"type": "default"
					}
				],
				"url": {
					"raw": "{{base_url}}/webhooks/v1/webhooks/{{webhook_id}}",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"webhooks",
						"v1",
						"webhooks",
						"{{webhook_id}}"
					]
				}
			},
			"response": []
		},
		{
			"name": "Delete All",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Should pass\", () => {\r",
							"    pm.response.to.have.status(200)\r",
							"\r",
							"    const webhookIds = pm.response.json().webhooks.map(x => x.id);\r",
							"    \r",
							"    for (let id of webhookIds)\r",
							"    {\r",
							"        console.log(`Deleting ${id}`);\r",
							"        \r",
							"        pm.sendRequest({\r",
							"            url: `${pm.request.url}/${id}`,\r",
							"            method: 'DELETE',\r",
							"            header: {\r",
							"                'Merchant-Serial-Number': `${pm.environment.get(\"merchantSerialNumber\")}`,\r",
							"                'Ocp-Apim-Subscription-Key': `${pm.environment.get(\"Ocp-Apim-Subscription-Key\")}`,\r",
							"                'Authorization': `Bearer ${pm.environment.get(\"access_token\")}`\r",
							"                'Vipps-System-Name': `Bearer ${pm.environment.get(\"vipps_system_name\")}`\r",
							"                'Vipps-System-Version': `Bearer ${pm.environment.get(\"vipps_system_version\")}`\r",
							"                'Vipps-System-Plugin-Name': `Bearer ${pm.environment.get(\"vipps_system_plugin_name\")}`\r",
							"                'Vipps-System-Plugin-Version': `Bearer ${pm.environment.get(\"vipps_system_plugin_version\")}`\r",
							"            }\r",
							"        },\r",
							"        (_, response) => pm.expect(response).to.have.status(204))\r",
							"    }\r",
							"})"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{access_token}}",
							"type": "string"
						}
					]
				},
				"method": "GET",
				"header": [
					{
						"key": "Ocp-Apim-Subscription-Key",
						"value": "{{Ocp-Apim-Subscription-Key}}",
						"type": "default"
					},
					{
						"key": "Merchant-Serial-Number",
						"value": "{{merchantSerialNumber}}",
						"type": "default"
					},
					{
						"key": "Vipps-System-Name",
						"value": "{{vipps_system_name}}",
						"type": "default"
					},
					{
						"key": "Vipps-System-Version",
						"value": "{{vipps_system_version}}",
						"type": "default"
					},
					{
						"key": "Vipps-System-Plugin-Name",
						"value": "{{vipps_system_plugin_name}}",
						"type": "default"
					},
					{
						"key": "Vipps-System-Plugin-Version",
						"value": "{{vipps_system_plugin_version}}",
						"type": "default"
					}
				],
				"url": {
					"raw": "{{base_url}}/webhooks/v1/webhooks",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"webhooks",
						"v1",
						"webhooks"
					]
				}
			},
			"response": []
		}
	]
}